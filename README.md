# ğŸš— DQN ê¸°ë°˜ ì™•ë³µ 8ì°¨ì„  traffic light control system

# ëª©ì°¨
1. [í”„ë¡œì íŠ¸ ì†Œê°œ](#1-í”„ë¡œì íŠ¸-ì†Œê°œ)
2. [í”„ë¡œì íŠ¸ ì§„í–‰](#2-í”„ë¡œì íŠ¸-ì§„í–‰)
3. [ì‹¤í—˜ ê²°ê³¼](#3-ì‹¤í—˜-ê²°ê³¼)
4. [Contact](#4-Contact)

# 1. í”„ë¡œì íŠ¸ ì†Œê°œ
(1) ì£¼ì œ ë° ëª©í‘œ
- ì˜¤ëŠ˜ë‚  ì‚¬íšŒ ëŒ€ë¶€ë¶„ì˜ ì‹ í˜¸ë“±ì€ ì‹ í˜¸ì˜ ìˆœì„œì™€ ì£¼ê¸°ê°€ ì •í•´ì§„ ê³ ì •í˜• ì‹ í˜¸ì²´ê³„ë¥¼ ì±„íƒí•˜ê³  ìˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŠ” ê¸‰ë³€í•˜ëŠ” êµí†µ ë³€í™”ì˜ íë¦„ì— ìœ ë™ì ìœ¼ë¡œ ëŒ€ì‘í•˜ì§€ ëª»í•œë‹¤ëŠ” ë‹¨ì ì´ ìˆê¸°ì— ì´ëŸ¬í•œ ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ ê°•í™”í•™ìŠµ ê¸°ë°˜ ì ì‘í˜• ì‹ í˜¸ ì²´ê³„ê°€ ì—°êµ¬ë˜ê³  ìˆë‹¤. ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì´ë¥¼ ë”ìš± ê°œì„ í•˜ê³ ì í˜„ì‹¤ ì¡°ê±´ì„ ë°˜ì˜í•˜ê³  ì—¬ëŸ¬ ê¸°ë²•ì„ ë¹„êµí•˜ë©° ìµœì ì˜ ì‹ í˜¸ ì²´ê³„ë¥¼ ê³ ì•ˆí•˜ì˜€ë‹¤. 

(2) í‰ê°€ì§€í‘œ
- êµì°¨ë¡œ ë‚´ ì°¨ëŸ‰ ëŒ€ê¸°ì‹œê°„
- êµì°¨ë¡œ ë‚´ ì°¨ëŸ‰ ëŒ€ê¸°ì—´

(3) ê°œë°œ í™˜ê²½  
- GPU : GTX 1070Ti
- SUMO : êµí†µì‹ í˜¸ì œì–´ library
- state : waiting time, queue length
- action : traffic light selection
- reward : reduced waiting time, queue length difference after action

# 2. í”„ë¡œì íŠ¸ ì§„í–‰
## 1. Simulation Environment
| **1** | **2** | **3** | **4** |
|------------|------------|------------|------------|
| ![image](https://github.com/user-attachments/assets/dbf4378b-1414-45e8-acf2-e37d00622ee1) | ![image](https://github.com/user-attachments/assets/2d17819b-58b5-4bfb-bbc3-f00a4fb2fa97) | ![Step 3](https://github.com/user-attachments/assets/81fdcd66-283d-47af-9cbd-b23e2a71b3aa) | ![Step 4](https://github.com/user-attachments/assets/87a7a0d8-fc32-4768-aa48-afa0af1d7f19) |
1. í•œ ì—í”¼ì†Œë“œë‹¹ 1000ëŒ€ì˜ ì°¨ëŸ‰ ìƒì„±
2. ê° êµì°¨ë¡œì˜ ì§„ì…ì°¨ë„ì—ì„œ 1ì°¨ì„ ì€ ì¢ŒíšŒì „, 2,3ì°¨ì„ ì€ ì§ì§„, 4ì°¨ì„ ì€ ì§ì§„ ë˜ëŠ” ìš°íšŒì „ìœ¼ë¡œ êµ¬ì„±
3. ì‹¤ì œ êµí†µëŸ‰ì´ ëŠ˜ì–´ë‚˜ëŠ” ì‹œê°„ëŒ€ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•˜ì—¬, ë¡œê·¸ì •ê·œë¶„í¬ë¥¼ í†µí•´ ì§„ì…ì°¨ë„ë³„ë¡œ ì°¨ëŸ‰ì´ ë§ì´ ìƒì„±ë˜ëŠ” ì‹œê°„ëŒ€ ì„¤ì •
4. ì°¨ëŸ‰ì˜ í¬ê¸°ëŠ” 5m(default) ì•ë’¤ ì°¨ ê°„ê²©ì€ 2.5m

## 2. ì°¨ì„  êµ¬ì—­í™”
![image](https://github.com/user-attachments/assets/7316691e-da5f-4af4-95ca-d6c4ea0e931a)
- ê° ì§„ì…ì°¨ì„ ì„ 100ê°œì˜ cellë¡œ êµ¬ì—­í™”í•˜ì—¬ 1ì´ˆê°„ê²©ìœ¼ë¡œ cellì— ì¡´ì¬í•˜ëŠ” ì°¨ëŸ‰ì— ëŒ€í•œ ì •ë³´ ì·¨ë“
- 4ì°¨ì„  ì§„ì…ì°¨ë„ 4ê°œì— ê° 100ê°œì˜ cellë¡œ ì´ë£¨ì–´ì ¸ ìˆì–´ì„œ, ì´ 1600ê°œì˜ cellì„ 1ì´ˆë§ˆë‹¤ ê°±ì‹ í•˜ì—¬, ì°¨ëŸ‰ì˜ ìœ„ì¹˜, ëŒ€ê¸°ì‹œê°„, ì†ë„ë¥¼ ì¸¡ì •

| **ì°¨ëŸ‰ ì¡´ì¬ì—¬ë¶€(queue_length)** | **ì°¨ëŸ‰ ì†ë„** | **ì°¨ëŸ‰ ëŒ€ê¸°ì‹œê°„** |
|------------|------------|------------|
|![image](https://github.com/user-attachments/assets/2ea745cb-90e3-4ae2-80f0-677de5672ed9)|![image](https://github.com/user-attachments/assets/aba4525f-48a8-4a4f-846a-da87959f154d)|![image](https://github.com/user-attachments/assets/26103c13-e1ad-4a81-bec6-6c6d809e5251)|

## 3. ì‹ í˜¸ ì„ íƒí•˜ëŠ” action space
![image](https://github.com/user-attachments/assets/9be5903d-9f9a-4e1a-9821-68c07f5356e1)
- 1 episodeë‹¹ 3600 stepsìœ¼ë¡œ êµ¬ì„± (ì—í”¼ì†Œë“œë‹¹ 3600ì´ˆ)
- Green Light ì¢…ë£Œí›„ 3step ë™ì•ˆ ë™ì¼í•œ ë°©í–¥ì˜ Yellow Light ì‹ í˜¸ ì‹¤í–‰ (ex. N/S Green Light ì´í›„ ë‹¤ë¥¸ ë°©í–¥ìœ¼ë¡œ ì‹ í˜¸ê°€ ë°”ë€Œë©´ ì‹ í˜¸ê°€ ë°”ë€Œê¸° ì „ N/S Yellow Light ì‹ í˜¸ ë°œìƒ)
- ì§ì§„ ë° ìš°íšŒì „(2~4ì°¨ì„ ) 8 steps, ì¢ŒíšŒì „ (1ì°¨ì„ ) 4 stepsë¡œ ì‹ í˜¸ ê¸¸ì´ ê³ ì •
- Green Light ì‹¤í–‰ ì´í›„ ìœ„ì˜ 4ê°€ì§€ ë°©í–¥ ì¤‘ íƒ 1 í•˜ì—¬ ì‹¤í–‰

## 4. Reward
- íŠ¹ì • ë°©í–¥ì˜ ì‹ í˜¸ë§Œ ê³„ì†í•´ì„œ íƒí•˜ì§€ ì•Šë„ë¡œ ëŒ€ê¸°ì‹œê°„, ëŒ€ê¸°ì—´ì— ê³µì •ì„± ì§€ìˆ˜ë¥¼ ì ìš© ([Jain's Fairness](https://en.wikipedia.org/wiki/Fairness_measure))

  $$
  R = -\left( w_1 \frac{W}{W_{\text{avg}}} + w_2 \frac{Q}{Q_{\text{avg}}} \right) + w_3 \left( \frac{w_1}{w_1 + w_2} F_w + \frac{w_2}{w_1 + w_2} F_q \right)
  $$  

- ì „ì²´ ì°¨ì„ ì˜ ëŒ€ê¸°ì‹œê°„ ì´í•©, ëŒ€ê¸°ì—´ ì´í•©ì„ ì¤„ì¼ ìˆ˜ ìˆê²Œ ìŒì˜ ë³´ìƒê°’ìœ¼ë¡œ ì„¤ì •
- ëŒ€ê¸°ì‹œê°„
  - ê° ì§„ì…ì°¨ë„ì˜ 4ê°œì˜ laneì˜ ëª¨ë“  ì°¨ëŸ‰ ëŒ€ê¸°ì‹œê°„ì˜ ì´í•©
  - ì°¨ì„  ë‚´ ì¡´ì¬í•˜ëŠ” ì°¨ëŸ‰ì˜ ì²´ë¥˜ ê¸°ê°„(step)ì„ ì§„ì… ì‹œì -ë¹ ì ¸ë‚˜ê°„ ì‹œì ìœ¼ë¡œ ê³„ì‚°
  - ì—í”¼ì†Œë“œ ì¢…ë£Œì‹œ ì”ë¥˜ ì°¨ëŸ‰ì€ 3600-ì§„ì…stepìœ¼ë¡œ ê³„ì‚°
- ëŒ€ê¸°ì—´
  - ê° ì°¨ì„ ì—ì„œ ì°¨ëŸ‰ì´ ì¡´ì¬í•˜ê³  ì†ë„ë„ 0.1ë³´ë‹¤ ì‘ì€ ê²½ìš°, ëŒ€ê¸°ì¤‘ì¸ ì°¨ëŸ‰ìœ¼ë¡œ íŒë‹¨í•´ ëŒ€ê¸°ì—´ë¡œ count
  - ì°¨ì„ ì— ì°¨ëŸ‰ì´ ì¡´ì¬í•˜ì§€ë§Œ, ì†ë„ê°€ 0.1ë³´ë‹¤ ë¹ ë¥´ë©´ not count
  - ê° ì°¨ì„ ì— ë™ì¼í•œ ì¡°ê±´ ì ìš©í•´ì„œ ëª¨ë“  ëŒ€ê¸°ì—´ì„ sum

## 5. History state ë°˜ì˜
![image](https://github.com/user-attachments/assets/2c2792ba-8068-4af5-a363-b0756a6deeb9)
- ì´ì „ actionì´ ëë‚œ í›„ stateë¥¼ ë°˜ì˜í•´ì„œ, DQN model inputìœ¼ë¡œ ë„£ìŒ
- ì„¸ state tensorë¥¼ concat ì—°ì‚°í•˜ì—¬ ì…ë ¥

# 3. ì‹¤í—˜ ê²°ê³¼
## 1. History state ë°˜ì˜ ì „í›„ ë¹„êµ
![image](https://github.com/user-attachments/assets/9f417ccb-0944-47e3-9bd5-f0969accc552)

|-|prev_state+current_state|only current_state|
|:-:|:-:|:-:|
|wait time|28.81|31.23|
|queue length|0.294|0.396|
|reward|-0.042|-0.137|

ì´ì „ stateë¥¼ ë°˜ì˜í•œ ê²°ê³¼ê°€ ë” ì¢‹ê²Œ ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
## 2. Fairness ìœ ë¬´ ë¹„êµ
![image](https://github.com/user-attachments/assets/0f0f890a-1022-42e0-8051-16a0f44c0bd3)

|-|fairness O|fairness X|
|:-:|:-:|:-:|
|wait time E |2.24|4.87|
|wait time W |4.13|10.32|
|wait time S |3.74|5.71|
|wait time N |3.31|3.49|

fairnessë¥¼ ë°˜ì˜í•œ ê²°ê³¼ ê° ì§„ì…ì°¨ì„ ì—ì„œì˜ ëŒ€ê¸°ì‹œê°„ì´ ë³´ë‹¤ ë” ê· ë“±í•˜ê²Œ ë¹ ì§€ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

# 4. Contact
tngoc@naver.com
iankim010209@gmail.com
